<% content_for :title, "#{@user.full_name} - Users - Framefox Connect Admin" %>

<div class="space-y-6">
  <!-- Page Header -->
  <div class="flex items-center justify-between">
    <div class="space-y-2">
      <div class="flex items-center space-x-2">
        <%= link_to admin_users_path, class: "text-slate-600 hover:text-slate-900" do %>
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
          </svg>
        <% end %>
        <h1 class="scroll-m-20 text-3xl font-semibold tracking-tight text-slate-900">
          <%= @user.full_name %>
        </h1>
      </div>
      <p class="text-lg text-slate-600">
        <%= @user.email %>
      </p>
    </div>
    
    <div class="flex space-x-2">
      <%= button_to invite_admin_user_path(@user), method: :post,
          class: "bg-blue-100 text-blue-800 hover:bg-blue-200 px-4 py-2 rounded-md text-sm font-medium transition-colors inline-flex items-center space-x-2" do %>
        <%= svg_icon("EmailFollowUpIcon", class: "w-5 h-5") %>
        <span><%= @user.encrypted_password.present? ? "Resend Invite" : "Send Invite" %></span>
      <% end %>
      
      <%= button_to impersonate_admin_user_path(@user), method: :post,
          class: "bg-yellow-100 text-yellow-800 hover:bg-yellow-200 px-4 py-2 rounded-md text-sm font-medium transition-colors inline-flex items-center space-x-2" do %>
        <%= svg_icon("EyeglassesIcon", class: "w-5 h-5") %>
        <span>Impersonate</span>
      <% end %>
      
      <%= link_to edit_admin_user_path(@user), class: "bg-slate-100 text-slate-900 hover:bg-slate-200 px-4 py-2 rounded-md text-sm font-medium transition-colors" do %>
        Edit User
      <% end %>
    </div>
  </div>

  <% unless @user.organization.present? %>
    <!-- No Organization Warning -->
    <div class="bg-amber-50 border border-amber-200 rounded-lg p-4 flex items-start space-x-3">
      <svg class="w-5 h-5 text-amber-600 mt-0.5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
        <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/>
      </svg>
      <div>
        <h3 class="text-sm font-semibold text-amber-800">No Organization Assigned</h3>
        <p class="text-sm text-amber-700 mt-1">This user cannot create or view orders until they are assigned to an organization.</p>
      </div>
    </div>
  <% end %>

  <!-- User Details -->
  <div class="bg-white border border-slate-200 rounded-lg p-6">
    <h2 class="text-lg font-semibold text-slate-900 mb-4">User Information</h2>
    <dl class="grid grid-cols-1 gap-4 sm:grid-cols-2">
      <div>
        <dt class="text-sm font-medium text-slate-500">Email</dt>
        <dd class="mt-1 text-sm text-slate-900"><%= @user.email %></dd>
      </div>
      <div>
        <dt class="text-sm font-medium text-slate-500">Full Name</dt>
        <dd class="mt-1 text-sm text-slate-900"><%= @user.full_name %></dd>
      </div>
      <div>
        <dt class="text-sm font-medium text-slate-500">First Name</dt>
        <dd class="mt-1 text-sm text-slate-900"><%= @user.first_name.presence || "—" %></dd>
      </div>
      <div>
        <dt class="text-sm font-medium text-slate-500">Last Name</dt>
        <dd class="mt-1 text-sm text-slate-900"><%= @user.last_name.presence || "—" %></dd>
      </div>
      <div>
        <dt class="text-sm font-medium text-slate-500">Country</dt>
        <dd class="mt-1 text-sm text-slate-900"><%= @user.country.present? ? @user.country_name : "—" %></dd>
      </div>
      <div>
        <dt class="text-sm font-medium text-slate-500">Organization</dt>
        <dd class="mt-1 text-sm text-slate-900">
          <% if @user.organization.present? %>
            <%= link_to @user.organization.name, admin_organization_path(@user.organization), class: "text-blue-600 hover:underline" %>
          <% else %>
            <span class="text-slate-400">—</span>
          <% end %>
        </dd>
      </div>
      <div>
        <dt class="text-sm font-medium text-slate-500">Admin Status</dt>
        <dd class="mt-1 text-sm">
          <% if @user.admin? %>
            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
              Admin User
            </span>
          <% else %>
            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-slate-100 text-slate-800">
              Regular User
            </span>
          <% end %>
        </dd>
      </div>
      <div>
        <dt class="text-sm font-medium text-slate-500">Joined</dt>
        <dd class="mt-1 text-sm text-slate-900"><%= @user.created_at.strftime("%B %d, %Y at %I:%M %p") %></dd>
      </div>
      <div>
        <dt class="text-sm font-medium text-slate-500">Last Updated</dt>
        <dd class="mt-1 text-sm text-slate-900"><%= @user.updated_at.strftime("%B %d, %Y at %I:%M %p") %></dd>
      </div>
    </dl>
  </div>

  <!-- Shopify Accounts -->
  <div class="bg-white border border-slate-200 rounded-lg p-6">
    <h2 class="text-lg font-semibold text-slate-900 mb-4">
      Shopify Accounts
      <span class="text-sm font-normal text-slate-500">(Framefox Shopify)</span>
    </h2>
    
    <% if @shopify_customers.any? %>
      <div class="space-y-3">
        <% @shopify_customers.each do |shopify_customer| %>
          <div class="border border-slate-200 rounded-lg p-4">
            <div class="flex items-center justify-between">
              <div>
                <p class="text-sm font-medium text-slate-900">External ID: <%= shopify_customer.external_shopify_id %></p>
                <% if shopify_customer.company %>
                  <p class="text-xs text-slate-500">Company: <%= shopify_customer.company.company_name %></p>
                <% end %>
              </div>
              <%= link_to "View", admin_shopify_customer_path(shopify_customer), 
                  class: "text-sm text-blue-600 hover:text-blue-800" %>
            </div>
          </div>
        <% end %>
      </div>
    <% else %>
      <p class="text-sm text-slate-500">No Shopify accounts linked to this user.</p>
    <% end %>
  </div>

  <!-- Stores -->
  <div class="bg-white border border-slate-200 rounded-lg p-6">
    <h2 class="text-lg font-semibold text-slate-900 mb-4">
      Stores
      <span class="text-sm font-normal text-slate-500">(<%= @stores.count %>)</span>
    </h2>
    
    <% if @stores.any? %>
      <div class="space-y-3">
        <% @stores.each do |store| %>
          <div class="border border-slate-200 rounded-lg p-4">
            <div class="flex items-center justify-between">
              <div>
                <p class="text-sm font-medium text-slate-900"><%= store.name %></p>
                <p class="text-xs text-slate-500">
                  <%= store.platform_display_name %> • 
                  <%= store.display_identifier %>
                </p>
              </div>
              <%= link_to "View Store", admin_store_path(store), 
                  class: "text-sm text-blue-600 hover:text-blue-800" %>
            </div>
          </div>
        <% end %>
      </div>
    <% else %>
      <p class="text-sm text-slate-500">No stores connected for this user.</p>
    <% end %>
  </div>

  <!-- Danger Zone -->
  <div class="bg-white border border-red-200 rounded-lg p-6">
    <h2 class="text-lg font-semibold text-red-900 mb-2">Danger Zone</h2>
    <p class="text-sm text-slate-600 mb-4">
      Deleting this user will remove all associated Shopify accounts and store connections.
    </p>
    <%= button_to "Delete User", admin_user_path(@user), method: :delete,
        form: { onsubmit: "return confirm('Are you sure you want to delete this user? This action cannot be undone.')" },
        class: "bg-red-600 text-white hover:bg-red-700 px-4 py-2 rounded-md text-sm font-medium transition-colors" %>
  </div>
</div>


<% content_for :title, "#{@product.title} - #{@store.name}" %>

<div class="space-y-8">
  <!-- Breadcrumb -->
  <div class="flex items-center space-x-2 text-sm text-slate-500">
    <%= link_to connections_root_path, class: "hover:text-slate-700" do %>
      Connections
    <% end %>
    <span>/</span>
    <%= link_to connections_stores_path, class: "hover:text-slate-700" do %>
      Stores
    <% end %>
    <span>/</span>
    <%= link_to connections_store_path(@store), class: "hover:text-slate-700" do %>
      <%= @store.name %>
    <% end %>
    <span>/</span>
    <%= link_to connections_store_products_path(@store), class: "hover:text-slate-700" do %>
      Products
    <% end %>
    <span>/</span>
    <span class="text-slate-900"><%= @product.title %></span>
  </div>

  <!-- Product Header -->
  <div class="flex items-start justify-between">
    <div class="space-y-4 flex-1">
      <div class="space-y-2">
        <h1 class="scroll-m-20 text-3xl font-semibold tracking-tight text-slate-900">
          <%= @product.title %>
        </h1>
        <div class="flex items-center space-x-4 text-sm text-slate-600">
          <span>External ID: <%= @product.external_id %></span>
          <span>•</span>
          <span>Handle: <%= @product.handle %></span>
          <% if @product.vendor.present? %>
            <span>•</span>
            <span>Vendor: <%= @product.vendor %></span>
          <% end %>
        </div>
      </div>
    </div>
    
    <div class="flex items-center space-x-2 ml-8">
      <span class="inline-flex items-center rounded-full px-3 py-1 text-sm font-medium 
            <%= @product.status == 'active' ? 'bg-green-100 text-green-800' : 
                @product.status == 'draft' ? 'bg-yellow-100 text-yellow-800' : 
                'bg-gray-100 text-gray-800' %>">
        <%= @product.status.humanize %>
      </span>
      
      <%= link_to sync_from_platform_connections_store_product_path(@store, @product), method: :post,
          class: "bg-slate-100 text-slate-900 hover:bg-slate-200 px-4 py-2 rounded-md text-sm font-medium transition-colors" do %>
        Sync from <%= @store.platform.humanize %>
      <% end %>
    </div>
  </div>

  <!-- Product Details Grid -->
  <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
    <!-- Product Image & Metadata (1/3) -->
    <div class="space-y-4">

      <div class="aspect-square bg-slate-50 rounded-lg border border-slate-200 flex items-center justify-center">
        <% if @product.featured_image_url.present? %>
          <img src="<%= @product.featured_image_url %>" alt="<%= @product.title %>" class="w-full h-full object-cover rounded-lg">
        <% else %>
          <div class="text-center space-y-2">
            <svg class="w-16 h-16 text-slate-400 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
            </svg>
            <p class="text-sm text-slate-500">No image available</p>
          </div>
        <% end %>
      </div>
      <!-- Metadata -->
      <div>
        <h3 class="text-lg font-semibold text-slate-900 mb-4">Details</h3>
        <div class="space-y-2 text-sm">
          <div class="flex justify-between">
            <span class="text-slate-600">Created:</span>
            <span class="text-slate-900"><%= @product.created_at.strftime("%B %d, %Y") %></span>
          </div>
          <div class="flex justify-between">
            <span class="text-slate-600">Updated:</span>
            <span class="text-slate-900"><%= @product.updated_at.strftime("%B %d, %Y") %></span>
          </div>
          <% if @product.published_at %>
            <div class="flex justify-between">
              <span class="text-slate-600">Published:</span>
              <span class="text-slate-900"><%= @product.published_at.strftime("%B %d, %Y") %></span>
            </div>
          <% end %>
        </div>
      </div>
    </div>

    <!-- Variants Section (2/3) -->
    <div class="lg:col-span-2">
      <div class="bg-white border border-slate-200 rounded-lg shadow-sm">
        <div class="p-6 border-b border-slate-200">
          <div class="flex items-center justify-between">
            <h2 class="text-lg font-semibold text-slate-900">
              Product Variants (<%= @variant_count %>)
            </h2>
          </div>
        </div>
        
        <div class="overflow-x-auto">
          <table class="w-full">
            <thead class="border-b border-slate-200 bg-slate-50">
              <tr>
                <th class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">Variant</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">Price</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">SKU</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">Options</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">Status</th>
              </tr>
            </thead>
            <tbody class="divide-y divide-slate-200">
              <% @variants.each do |variant| %>
                <tr class="hover:bg-slate-50">
                  <td class="px-6 py-4">
                    <div class="flex items-center space-x-3">
                      <% if variant.image_url.present? %>
                        <img src="<%= variant.image_url %>" alt="<%= variant.title %>" class="w-10 h-10 rounded-md object-cover">
                      <% else %>
                        <div class="w-10 h-10 bg-slate-200 rounded-md flex items-center justify-center">
                          <svg class="w-5 h-5 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                          </svg>
                        </div>
                      <% end %>
                      <div>
                        <p class="font-medium text-slate-900"><%= variant.title %></p>
                        <p class="text-sm text-slate-500">ID: <%= variant.external_variant_id %></p>
                      </div>
                    </div>
                  </td>
                  <td class="px-6 py-4">
                    <div>
                      <p class="font-semibold text-slate-900">$<%= variant.price %></p>
                      <% if variant.compare_at_price.present? %>
                        <p class="text-sm text-slate-500 line-through">$<%= variant.compare_at_price %></p>
                      <% end %>
                    </div>
                  </td>
                  <td class="px-6 py-4">
                    <p class="text-sm text-slate-900"><%= variant.sku.present? ? variant.sku : 'No SKU' %></p>
                  </td>
                  <td class="px-6 py-4">
                    <% if variant.selected_options.any? %>
                      <div class="space-y-1">
                        <% variant.selected_options.each do |option| %>
                          <span class="inline-flex items-center rounded-md bg-slate-100 px-2 py-1 text-xs font-medium text-slate-800">
                            <%= option["name"] %>: <%= option["value"] %>
                          </span>
                        <% end %>
                      </div>
                    <% else %>
                      <span class="text-sm text-slate-500">Default</span>
                    <% end %>
                  </td>
                  <td class="px-6 py-4">
                    <span class="inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-medium 
                          <%= variant.available_for_sale? ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800' %>">
                      <%= variant.available_for_sale? ? 'Available' : 'Unavailable' %>
                    </span>
                  </td>
                </tr>
              <% end %>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <!-- Actions -->
  <div class="flex items-center space-x-4">
    <%= link_to connections_store_products_path(@store), 
        class: "hover:bg-slate-100 hover:text-slate-900 px-4 py-2 rounded-md text-sm font-medium transition-colors" do %>
      ← Back to Products
    <% end %>
    
    <%= link_to sync_from_platform_connections_store_product_path(@store, @product),
        class: "bg-slate-900 text-slate-50 hover:bg-slate-800 px-4 py-2 rounded-md text-sm font-medium transition-colors" do %>
      Sync from <%= @store.platform.humanize %>
    <% end %>
    
    <% if @product.platform_url.present? %>
      <%= link_to @product.platform_url, target: "_blank", rel: "noopener",
          class: "bg-slate-100 text-slate-900 hover:bg-slate-200 px-4 py-2 rounded-md text-sm font-medium transition-colors inline-flex items-center space-x-2" do %>
        <span>View on <%= @store.platform.humanize %></span>
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path>
        </svg>
      <% end %>
    <% end %>
  </div>
</div>

<% content_for :title, "#{@product.title} - #{@store.name}" %>

<div class="space-y-8">


   <!-- Actions -->
  <div class="flex items-center justify-between">
    <%= link_to connections_store_path(@store), 
        class: "hover:bg-slate-100 hover:text-slate-900 px-4 py-2 rounded-md text-sm font-medium transition-colors" do %>
      ‚Üê Back to <%= @store.name %>
    <% end %>
    
    <!-- Actions Dropdown -->
    <div class="relative" data-dropdown>
      <button 
        type="button"
        data-dropdown-trigger
        class="inline-flex items-center px-4 py-2 border border-slate-300 rounded-md  bg-white text-sm font-medium text-slate-700 hover:bg-slate-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-slate-500 transition-colors"
      >
        <span>Actions</span>
        <i class="fa-solid fa-chevron-down ml-2 h-4 w-4"></i>
      </button>

      <!-- Dropdown Menu -->
      <div 
        data-dropdown-menu
        class="hidden absolute right-0 z-10 mt-2 w-64 rounded-md shadow-lg bg-white ring-1 ring-black ring-opacity-5 focus:outline-none"
      >
        <div class="py-1" role="none">
          <%= link_to sync_from_platform_connections_store_product_path(@store, @product),
              class: "group flex items-center px-4 py-2 text-sm text-slate-700 hover:bg-slate-100 hover:text-slate-900 transition-colors",
              role: "menuitem" do %>
            <%= svg_icon('RefreshIcon', class: 'w-6 h-6 mr-3') %>
            Pull changes from <%= @store.platform.humanize %>
          <% end %>
          
          
          
          <% if @product.has_variant_mappings? %>
          <!-- Separator -->
          <div class="border-t border-slate-200 my-1"></div>
            <%= link_to sync_variant_mappings_connections_store_product_path(@store, @product),
                class: "group flex items-center px-4 py-2 text-sm text-slate-700 hover:bg-slate-100 hover:text-slate-900 transition-colors",
                role: "menuitem",
                data: { confirm: "This will sync all variant mappings to Shopify. Continue?" } do %>
              <%= svg_icon('ImageMagicIcon', class: 'w-6 h-6 mr-3') %>
              Sync all variant images to Shopify
            <% end %>
          <% end %>
          
          <% if @product.platform_url.present? %>
            <!-- Separator -->
            <div class="border-t border-slate-200 my-1"></div>
            
            <%= link_to @product.platform_url, 
                target: "_blank", 
                rel: "noopener",
                class: "group flex items-center px-4 py-2 text-sm text-slate-700 hover:bg-slate-100 hover:text-slate-900 transition-colors",
                role: "menuitem" do %>
              <%= svg_icon('ExternalSmallIcon', class: 'w-6 h-6 mr-3') %>
              View in <%= @store.platform.humanize %> admin
            <% end %>
          <% end %>
        </div>
      </div>
    </div>
  </div>

  <!-- Product Header -->
  <%= react_component("ProductShowView", {
    product: {
      id: @product.id,
      title: @product.title,
      external_id: @product.external_id,
      handle: @product.handle,
      vendor: @product.vendor,
      featured_image_url: @product.featured_image_url,
      fulfilment_active: @product.fulfilment_active,
      platform_url: @product.platform_url,
      created_at: @product.created_at,
      updated_at: @product.updated_at,
      published_at: @product.published_at
    },
    store: {
      id: @store.id,
      name: @store.name
    },
    variants: @variants.map do |variant|
      {
        id: variant.id,
        title: variant.title,
        external_variant_id: variant.external_variant_id,
        fulfilment_active: variant.fulfilment_active,
        variant_mapping: variant.default_variant_mapping&.as_json(
          only: [
            :id, :image_id, :image_key, :frame_sku_id, :frame_sku_code, 
            :frame_sku_title, :frame_sku_cost_cents, :cx, :cy, :cw, :ch, :preview_url, :cloudinary_id,
            :image_width, :image_height, :frame_sku_description, :image_filename,
            :frame_sku_long, :frame_sku_short, :frame_sku_unit, :width, :height, :unit, :colour, :country_code
          ],
          methods: [
            :artwork_preview_thumbnail, :artwork_preview_medium, :artwork_preview_large,
            :framed_preview_thumbnail, :framed_preview_medium, :framed_preview_large,
            :frame_sku_cost_formatted, :frame_sku_cost_dollars, :dimensions_display
          ]
        )
      }
    end,
    variantCount: @variant_count,
    productTypeImages: {
      matted: asset_path('print-frame-matted.jpg'),
      unmatted: asset_path('print-frame-no-mat.jpg'),
      canvas: asset_path('canvas.jpg'),
      printOnly: asset_path('unframed.jpg')
    }
  }) %>

  

 
</div>
